<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Saisonknobeln</title>
		
		<style id="mati_keyframes_3d">
			@keyframes mati_animation_box_show {
				from {
					transform: perspective(400vh) translateZ(-50vh) rotateX(-90deg) translateZ(50vh);
				}
				to {
					transform: perspective(400vh) translateZ(-50vh) rotateX(0deg) translateZ(50vh);
				}
			}
			@keyframes mati_animation_box_hide {
				from {
					transform: perspective(400vh) translateZ(-50vh) rotateX(0deg) translateZ(50vh);
				}
				to {
					transform: perspective(400vh) translateZ(-50vh) rotateX(90deg) translateZ(50vh);
				}
			}
		</style>
		
        <link href="style.css" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<div id="mati_spiel_alles">
			<div id="mati_spiel_lobby" class="mati_box">
				<div id="mati_intro_overlay">
				</div>
				<div id="mati_titel_container" style="visibility: hidden">
					<!-- Sichtbarer Dokumentinhalt im body -->
					<svg id="mati_titel" preserveAspectRatio="xMidYMid meet" viewBox="0 0 800 160" xmlns="http://www.w3.org/2000/svg"
					  xmlns:xlink="http://www.w3.org/1999/xlink">

                        <defs>
                            <!-- width muss den gesamten Bereich abdecken vor dem downscaling -->
                            <filter id="mati_svg_shadow" x="0" y="0" width="1100" height="160" filterUnits="userSpaceOnUse">
                                <feGaussianBlur in="SourceGraphic" stdDeviation="2"/>
                                <feMerge>
                                  <feMergeNode/>
                                  <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                            <linearGradient id="mati_svg_farbverlauf" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0" stop-color="#ffcc33" />
                                <stop offset="1" stop-color="#ff7700" />
                            </linearGradient>
                        </defs>


                        <g transform="scale(.8,1) skewX(-20)" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <g id="mati_svg_saisonknobeln">
                                <g stroke="black" stroke-width="20" filter="url(#mati_svg_shadow)">
                                    <path id="mati_schriftzug_saisonknobeln" d="M 82 130
                                       m 0 -70  c 15 10 50 10 70 -10 c 7 -7 7 -28 -21 -28       c -80 0 65 115 -25 115 c -40 0 -40 -30 -30 -40 c -10 10 -10 40 30 40
                                       c 80 0 57 -55 95 -55 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 50 15 50
                                       q 25 0 25 -50 q 0 50 15 50
                                       q 10 0 35 -50 l -3 7 c 30 13 30 43 0 43
                                       c 60 0 40 -50 75 -50 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 10 15 10
                                       c 10 0 10 -10 20 -10 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25
                                       q 20 0 45 -50 q 25 -50 10 -50 q -15 0 -15 100 q 0 -50 17 -50 q 10 0 10 13 q 0 9 -20 13 c 20 0 20 24 40 24
                                       c 15 0 15 -50 30 -50 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25
                                       c 30 0 10 -50 45 -50 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 10 15 10
                                       c 20 0 60 -60 38 -60 c -20 0 -20 100 15 100 q 25 0 12 -50 q 20 20 40 20
                                       c 40 0 40 -20 25 -20 c -25 0 -25 50 0 50
                                       q 20 0 45 -50 q 25 -50 10 -50 c -20 0 -20 100 15 100
                                       c 15 0 15 -50 30 -50 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25 q 10 0 20 -10" />
                                </g>
                                <g stroke="url(#mati_svg_farbverlauf)" stroke-width="8">
                                    <path d="M 82 130
                                       m 0 -70  c 15 10 50 10 70 -10 c 7 -7 7 -28 -21 -28       c -80 0 65 115 -25 115 c -40 0 -40 -30 -30 -40 c -10 10 -10 40 30 40
                                       c 80 0 57 -55 95 -55 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 50 15 50
                                       q 25 0 25 -50 q 0 50 15 50
                                       q 10 0 35 -50 l -3 7 c 30 13 30 43 0 43
                                       c 60 0 40 -50 75 -50 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 10 15 10
                                       c 10 0 10 -10 20 -10 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25
                                       q 20 0 45 -50 q 25 -50 10 -50 q -15 0 -15 100 q 0 -50 17 -50 q 10 0 10 13 q 0 9 -20 13 c 20 0 20 24 40 24
                                       c 15 0 15 -50 30 -50 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25
                                       c 30 0 10 -50 45 -50 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 10 15 10
                                       c 20 0 60 -60 38 -60 c -20 0 -20 100 15 100 q 25 0 12 -50 q 20 20 40 20
                                       c 40 0 40 -20 25 -20 c -25 0 -25 50 0 50
                                       q 20 0 45 -50 q 25 -50 10 -50 c -20 0 -20 100 15 100
                                       c 15 0 15 -50 30 -50 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25 q 10 0 20 -10" />
                                </g>
                            </g>
                            <g id="mati_svg_saisonknobeln_ipunkt">
                                <g stroke="black" stroke-width="20" filter="url(#mati_svg_shadow)">
                                    <path id="mati_schriftzug_ipunkt" d="M -43 -50 l 10 0 l -10 0 m 50 50 m 250 55 l 0 -2" />
                                </g>
                                <g stroke="#ffcc33" stroke-width="8">
                                    <path d="M -43 -50 l 10 0 l -10 0 m 50 50 m 250 55 l 0 -2" />
                                </g>
                            </g>

                            <g id="mati_svg_saisonknobeln2" stroke="#ff0000" stroke-width="12">
                                <path d="M 82 130
                                   m 0 -70  c 15 10 50 10 70 -10 c 7 -7 7 -28 -21 -28       c -80 0 65 115 -25 115 c -40 0 -40 -30 -30 -40 c -10 10 -10 40 30 40
                                   c 80 0 57 -55 95 -55 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 50 15 50
                                   q 25 0 25 -50 q 0 50 15 50
                                   q 10 0 35 -50 l -3 7 c 30 13 30 43 0 43
                                   c 60 0 40 -50 75 -50 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 10 15 10
                                   c 10 0 10 -10 20 -10 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25
                                   q 20 0 45 -50 q 25 -50 10 -50 q -15 0 -15 100 q 0 -50 17 -50 q 10 0 10 13 q 0 9 -20 13 c 20 0 20 24 40 24
                                   c 15 0 15 -50 30 -50 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25
                                   c 30 0 10 -50 45 -50 q 10 0 15 10 q -5 -10 -15 -10 c -30 0 -30 50 -5 50 q 20 0 20 -35 l 0 -15 q 0 10 15 10
                                   c 20 0 60 -60 38 -60 c -20 0 -20 100 15 100 q 25 0 12 -50 q 20 20 40 20
                                   c 40 0 40 -20 25 -20 c -25 0 -25 50 0 50
                                   q 20 0 45 -50 q 25 -50 10 -50 c -20 0 -20 100 15 100
                                   c 15 0 15 -50 30 -50 q 10 0 10 25 l 0 25 q 0 -50 17 -50 q 10 0 10 25 q 0 25 10 25 q 10 0 20 -10" />
                            </g>
                            <g id="mati_svg_saisonknobeln_ipunkt2" stroke="#ff0000" stroke-width="12">
                                <path d="M -43 -50 l 10 0 l -10 0 m 50 50 m 250 55 l 0 -2" />
                            </g>
                        </g>



					</svg>
				</div>
				<div id="mati_spiel_lobby_credits"></div>
				<div id="mati_spiel_lobby_content">
					<div id="mati_spiel_spielerliste">
						<div id="mati_spiel_spielerliste_caption">
						</div>
						<div id="mati_spiel_spielerliste_content">
						</div>
					</div>
					<div id="mati_spiel_spielerwarteliste" style="display:none">
						<div id="mati_spiel_spielerwarteliste_caption">
						</div>
						<div id="mati_spiel_spielerwarteliste_content">
						</div>
					</div>
                    
                    <div id="mati_sprachauswahl">
                        <svg id="mati_sprachauswahl_button_links" viewbox="0 0 50 100">
                            <path d="M5,50 l40,-40 l0,80 z" stroke="black" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M5,50 l40,-40 l0,80 z" fill="white" />
                        </svg>
                        <div id="mati_sprachauswahl_flaggen_container">
                        </div>
                        <svg id="mati_sprachauswahl_button_rechts" viewbox="0 0 50 100">
                            <path d="M45,50 l-40,-40 l0,80 z" stroke="black" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M45,50 l-40,-40 l0,80 z" fill="white" />
                        </svg>
                    </div>
				</div>
				<audio autoplay loop id="mati_hauptmusik">
					<source src="hauptmusik.ogg" type="audio/ogg"-->
					<source src="hauptmusik.mp3" type="audio/mpeg">
				</audio> 
				<audio id="mati_rubrikintro_musik">
					<source src="rubrikintro.ogg" type="audio/ogg">
					<source src="rubrikintro.mp3" type="audio/mpeg">
				</audio> 
				
				<svg id="mati_hauptmusik_button" viewbox="0 0 200 120">
					<path d="M5 105 q0 -15 25 -15 q15 0 15 10 q0 15 -25 15 q-15 0 -15 -10 z" stroke="black" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" />
					<path d="M75 95 q0 -15 25 -15 q15 0 15 10 q0 15 -25 15 q-15 0 -15 -10 z" stroke="black" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" />
					<path d="M45 100 l0 -85 l-5 0 l0 85 z" stroke="black" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" />
					<path d="M115 90 l0 -85 l-5 5 l0 80 z" stroke="black" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" />
					<path d="M40 15 l75 -10 l0 20 l-75 10 z" stroke="black" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" />
					
					<path d="M5 105 q0 -15 25 -15 q15 0 15 10 q0 15 -25 15 q-15 0 -15 -10 z" fill="white" />
					<path d="M75 95 q0 -15 25 -15 q15 0 15 10 q0 15 -25 15 q-15 0 -15 -10 z" fill="white" />
					<path d="M45 100 l0 -85 l-5 0 l0 85 z" fill="white" />
					<path d="M115 90 l0 -85 l-5 5 l0 80 z" fill="white" />
					<path d="M40 15 l75 -10 l0 20 l-75 10 z" fill="white" />
					
					<path d="M115 60 m60 -45 a75 75 0 0 1 0 90" stroke="black" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" fill="none" />
					<path d="M115 60 m40 -30 a50 50 0 0 1 0 60" stroke="black" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" fill="none" />
					<path d="M115 60 m20 -15 a25 25 0 0 1 0 30" stroke="black" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" fill="none" />
					
					<path d="M115 60 m60 -45 a75 75 0 0 1 0 90" stroke="white" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" />
					<path d="M115 60 m40 -30 a50 50 0 0 1 0 60" stroke="white" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" />
					<path d="M115 60 m20 -15 a25 25 0 0 1 0 30" stroke="white" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" />
					
					<g class="mati_hauptmusik_button_x">
						<path d="M10 10 L190 110" stroke="black" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" fill="none" />
						<path d="M10 110 L190 10" stroke="black" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" fill="none" />
						
						<path d="M10 10 L190 110" stroke="#ff1111" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" />
						<path d="M10 110 L190 10" stroke="#ff1111" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" />
					</g>
				</svg>
			</div>
			<div id="mati_rubrik_intro" class="mati_box">
				<div id="mati_rubrik_intro_balken1"></div>
				<div id="mati_rubrik_intro_balken2"></div>
				<svg viewbox="0 0 1000 150">
					<defs>
						<filter id="mati_rubrik_text_shadow" filterUnits="userSpaceOnUse" x="0" y="0" width="100%" height="100%">
							<feGaussianBlur result="blurOut" in="SourceAlpha" stdDeviation="5" />
							<feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
						</filter>				
						<linearGradient id="mati_rubrik_text_verlauf" x1="0" y1="0" x2="0" y2="1">
							<stop offset="0" stop-color="#eeeeee" />
							<stop offset="1" stop-color="#bbbbbb" />
						</linearGradient>
					</defs>
					<text font-size="100" filter="url(#mati_rubrik_text_shadow)" stroke="url(#mati_rubrik_text_verlauf)" fill="none" stroke-width="3" font-weight="800" text-anchor="middle" id="mati_rubrik_intro_name" x="50%" y="110">
						Saisonknobeln
					</text>
				</svg>
			</div>
			<div id="mati_frage" class="mati_box">
				<div id="mati_frage_grid">
					<div id="mati_frage_erlaeuterung"></div>
					<div id="mati_frage_text_und_bild">
						<div id="mati_frage_text_container">
							<div id="mati_frage_text"></div>
						</div>
						<div id="mati_frage_bild"></div>
					</div>
					<div id="mati_frage_spieler_container">
						<div id="mati_frage_spieler">
						</div>
					</div>
				</div>
			</div>
			<div id="mati_frage_ergebnis" class="mati_box">
				<div id="mati_frage_ergebnis_schaetzungen_container_container">
					<div id="mati_frage_ergebnis_schaetzungen_container">
						<div id="mati_frage_ergebnis_tatsaechlich_container">
							<div id="mati_frage_ergebnis_tatsaechlich">
								<div id="mati_frage_ergebnis_strich">
								</div>
								<div id="mati_frage_ergebnis_tatsaechlich_label"></div>
								<div id="mati_frage_ergebnis_tatsaechlich_box">
									<div id="mati_frage_ergebnis_tatsaechlich_a"></div>
									<div id="mati_frage_ergebnis_tatsaechlich_doppelpunkt">:</div>
									<div id="mati_frage_ergebnis_tatsaechlich_b"></div>
								</div>
							</div>
						</div>
				
						<div id="mati_frage_ergebnis_schaetzungen">
						</div>
					</div>
				</div>
			</div>
			<div id="mati_punktestand" class="mati_box">
				<div id="mati_punktestand_spielerliste_container_container">
					<div id="mati_punktestand_ueberschrift">
					</div>
					<div id="mati_punktestand_spielerliste_container">
						<div id="mati_punktestand_spielerliste">
						</div>
					</div>
				</div>
			</div>
		</div>


		<script src="matiUtil.js" rel="script" type="application/javascript"></script>
		<script src="matiFarbutil.js" rel="script" type="application/javascript"></script>
		<script src="https://tiltspot.tv/api/game/game-1.0.0.js" rel="script" type="application/javascript"></script>
		<script src="saisonknobeln.js" rel="script" type="application/javascript"></script>
		<script>
			//TODO pausemenue implementieren
			//TODO booleanparameter aus zeigeContainer-Methode ist ueberfluessig
			//TODO das Hintergrundbild hat derzeit eine seltsame Pfadangabe... versuch CSS auszulagern und dann den Pfad weg zu lassen, oder nutze Assets-Ordner
		
			Tiltspot.on.ready = function() {
                matiUtil.pushBefehl(function() {
                    if (mati.sprachen.length === 0) {
                        matiUtil.loadJson(Tiltspot.get.assetUrl("language-list.json"), function(sprachen) {
                            //alle Sprachen laden
                            let zuLadendeSprachen = sprachen.length;
                            for (let spracheCode of sprachen) {
                                matiUtil.loadJson(Tiltspot.get.assetUrl("gui-l10n/" + spracheCode + ".json"), function(texte) {
                                    mati.sprachen.push({
                                        code : spracheCode,
                                        texte : texte
                                    });
                                    zuLadendeSprachen--;
                                    if (zuLadendeSprachen === 0) {
                                        document.getElementById('mati_sprachauswahl_flaggen_container').innerHTML = mati.sprachen.map(function (sprache) {
                                            return `
                                                <img id="mati_flagge_code_${sprache.code}" style="${sprache.code === mati.spracheCode ? 'display:block' : 'display:none'}" src="${Tiltspot.get.assetUrl(`flaggen/${sprache.texte.data_flagge}.svg`)}" alt="${matiUtil.htmlEscape(sprache.texte.data_name)}" />
                                            `;
                                        }).join('');
                                        
                                        document.getElementById('mati_sprachauswahl_button_links').addEventListener('click', function() {
                                            let indexAktuelleSprache = mati.getIndexAktuelleSprache();
                                            let neueSprache = mati.sprachen[(mati.sprachen.length + indexAktuelleSprache - 1) % mati.sprachen.length];
                                            mati.setSpracheCode(neueSprache.code);
                                        });
                                        document.getElementById('mati_sprachauswahl_button_rechts').addEventListener('click', function() {
                                            let indexAktuelleSprache = mati.getIndexAktuelleSprache();
                                            let neueSprache = mati.sprachen[(indexAktuelleSprache + 1) % mati.sprachen.length];
                                            mati.setSpracheCode(neueSprache.code);
                                        });
                                        document.getElementById('mati_sprachauswahl_flaggen_container').addEventListener('click', function() {
                                            let indexAktuelleSprache = mati.getIndexAktuelleSprache();
                                            let neueSprache = mati.sprachen[(indexAktuelleSprache + 1) % mati.sprachen.length];
                                            mati.setSpracheCode(neueSprache.code);
                                        });
                                        
                                        matiUtil.gotoNaechsterBefehl();
                                    }
                                });
                            }
                        });
                    }
                    else {
                        matiUtil.gotoNaechsterBefehl();
                    }
                });
                
                mati.setSpracheCode('en');
                mati.spielerChanged();
                
				matiUtil.pushBefehl(function() {
					mati.broadcast('zeigeHauptmenue');
					mati.zeigeContainer(document.getElementById('mati_spiel_lobby'), matiUtil.gotoNaechsterBefehl);
					
					
					
					
					
					
					
					var introAnimationStartzeit = null;
                    var mati_titel = document.getElementById('mati_titel');
                    var mati_svg_saisonknobeln = document.getElementById('mati_svg_saisonknobeln');
                    var mati_svg_saisonknobeln2 = document.getElementById('mati_svg_saisonknobeln2');
                    var mati_svg_saisonknobeln_ipunkt = document.getElementById('mati_svg_saisonknobeln_ipunkt');
                    var mati_svg_saisonknobeln_ipunkt2 = document.getElementById('mati_svg_saisonknobeln_ipunkt2');


                    var mati_schriftzug_saisonknobeln_length = document.getElementById('mati_schriftzug_saisonknobeln').getTotalLength();
                    var mati_schriftzug_ipunkt_length = document.getElementById('mati_schriftzug_ipunkt').getTotalLength();
                    var mati_schriftzug_stiftlaenge = 10;

                    var mati_titel_zoom_animationslaenge = 1000;
                    var mati_titel_introAnimationStartzeithoehe = window.innerWidth / 5;
                    var mati_titel_ziehlhoehe = document.getElementById('mati_titel_container').offsetHeight;
                    var mati_titel_introAnimationStartzeittop = window.innerHeight / 2 - window.innerWidth / 10;

                    var mati_schriftzug_schreibanimation_fertig = false;

                    mati_svg_saisonknobeln.setAttribute('stroke-dasharray', (mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length) + ' ' + mati_schriftzug_saisonknobeln_length);
                    mati_svg_saisonknobeln2.setAttribute('stroke-dasharray', mati_schriftzug_stiftlaenge + ' ' + (mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length));
                    mati_svg_saisonknobeln_ipunkt.setAttribute('stroke-dasharray', mati_schriftzug_ipunkt_length + ' ' + (mati_schriftzug_saisonknobeln_length * 2));
                    mati_svg_saisonknobeln_ipunkt2.setAttribute('stroke-dasharray', mati_schriftzug_stiftlaenge + ' ' +  (mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length));

                    mati_svg_saisonknobeln.setAttribute('stroke-dashoffset', mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length + mati_schriftzug_stiftlaenge);
                    mati_svg_saisonknobeln_ipunkt.setAttribute('stroke-dashoffset', mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length + mati_schriftzug_stiftlaenge);
                    mati_svg_saisonknobeln2.setAttribute('stroke-dashoffset', mati_schriftzug_stiftlaenge);
                    mati_svg_saisonknobeln_ipunkt2.setAttribute('stroke-dashoffset', mati_schriftzug_stiftlaenge);

                    document.getElementById('mati_titel_container').style['visibility'] = 'visible';

					function introAnimation(timestamp) {
						if (!introAnimationStartzeit) {
							introAnimationStartzeit = timestamp;
						}
						var progress = (timestamp - introAnimationStartzeit) / 2;

						if (progress < mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length + mati_schriftzug_stiftlaenge) {
							mati_svg_saisonknobeln.setAttribute('stroke-dashoffset', mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length + mati_schriftzug_stiftlaenge - progress);
							mati_svg_saisonknobeln_ipunkt.setAttribute('stroke-dashoffset', mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length + mati_schriftzug_stiftlaenge - progress);
                            mati_svg_saisonknobeln2.setAttribute('stroke-dashoffset', mati_schriftzug_stiftlaenge-progress);
                            mati_svg_saisonknobeln_ipunkt2.setAttribute('stroke-dashoffset', mati_schriftzug_stiftlaenge-progress);
						}
						else {
							if (!mati_schriftzug_schreibanimation_fertig) {
								let overlay = document.getElementById('mati_intro_overlay');
								overlay.parentNode.removeChild(overlay);
							
								mati_svg_saisonknobeln.removeAttribute('stroke-dashoffset');
								mati_svg_saisonknobeln_ipunkt.removeAttribute('stroke-dashoffset');
								mati_svg_saisonknobeln.removeAttribute('stroke-dasharray');
								mati_svg_saisonknobeln_ipunkt.removeAttribute('stroke-dasharray');

                                mati_svg_saisonknobeln2.parentNode.removeChild(mati_svg_saisonknobeln2);
                                mati_svg_saisonknobeln_ipunkt2.parentNode.removeChild(mati_svg_saisonknobeln_ipunkt2);
								mati_schriftzug_schreibanimation_fertig = true;
							}

							if (progress < mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length + mati_schriftzug_stiftlaenge + mati_titel_zoom_animationslaenge) {
								let zoomanimationsfortschritt = (progress - mati_schriftzug_saisonknobeln_length - mati_schriftzug_ipunkt_length - mati_schriftzug_stiftlaenge) / mati_titel_zoom_animationslaenge;
								mati_titel.style['top'] = (mati_titel_introAnimationStartzeittop * (1 - zoomanimationsfortschritt)) + 'px';
								mati_titel.style['height'] = (mati_titel_introAnimationStartzeithoehe + (mati_titel_ziehlhoehe - mati_titel_introAnimationStartzeithoehe) * zoomanimationsfortschritt) + 'px';
							}
							else {
								mati_titel.style['top'] = '0px';
								mati_titel.style['height'] = '100%';
								document.getElementById('mati_spiel_lobby_credits').style['display'] = 'block';
								document.getElementById('mati_spiel_lobby_content').style['display'] = 'flex';
								mati.spielerChanged();
							}
						}

						if (progress < mati_schriftzug_saisonknobeln_length + mati_schriftzug_ipunkt_length + mati_schriftzug_stiftlaenge + mati_titel_zoom_animationslaenge) {
							window.requestAnimationFrame(introAnimation);
						}
					}

					window.requestAnimationFrame(introAnimation);

					document.getElementById("mati_hauptmusik_button").addEventListener("click",function() {
						if (matiUtil.musikIstEingeschaltet) {
							matiUtil.musikAusschalten(document.getElementById("mati_hauptmusik"));
							for (let musikXIcon of document.getElementsByClassName("mati_hauptmusik_button_x")) {
								musikXIcon.style['visibility'] = 'visible';
							}
						}
						else {
							matiUtil.musikEinschalten(document.getElementById("mati_hauptmusik"));
							for (let musikXIcon of document.getElementsByClassName("mati_hauptmusik_button_x")) {
								musikXIcon.style['visibility'] = 'hidden';
							}
						}
						mati.broadcast('setSound');
					});
					
					
					
					
					
					
					
				});
			};
			Tiltspot.on.connect = function(controllerId) {
				mati.spielerChanged();
			}; 
			Tiltspot.on.disconnect = function(controllerId) {
				mati.spielerChanged();
			};
			Tiltspot.on.reconnect = function(controllerId) {
				mati.spielerChanged();
				mati.sendMsg(controllerId);
			};
			Tiltspot.on.msg = function (controllerId, msg, data) {
				switch (msg) { 
					case 'setSpracheCode':
						mati.setSpracheCode(data);
						break;
					case 'neuesSpiel':
						mati.neuesSpiel(data);
						break;
					case 'clientReady':
						//Client hat ggf. den letzten Befehl nicht mitbekommen
						mati.sendMsg(controllerId);
						break;
					case 'antwortAbgeben':
						let spieler = mati.getSpielerImLaufendenSpielById(controllerId);
						spieler.antwortAufAktuelleFrage = data.antwort;
						spieler.schaetzungAFuerAktuelleFrage = data.schaetzungAntwortA;
						spieler.schaetzungBFuerAktuelleFrage = data.schaetzungAntwortB;
						let spielerElement = document.getElementById('mati_frage_spieler').getElementsByClassName('mati_spieler_id_' + controllerId)[0];
						spielerElement.classList.remove('mati_wackelnd');
						spielerElement.classList.add('mati_spieler_fertig');
						mati.gotoNaechsterBefehlFallsAlleAntwortenAbgegebenWurden();
						//Nochmal Wartebefehl senden, damit bei Smartphone-Browser-Reload keine erneute Stimmabgabe moeglich ist
						mati.sendMsg(controllerId, 'zeigeWarten');
						break;
					case 'spielAbschliessen':
						matiUtil.gotoNaechsterBefehl();
						break;
					case 'setSound':
						if (data) {
							matiUtil.musikEinschalten(document.getElementById("mati_hauptmusik"));
							for (let musikXIcon of document.getElementsByClassName("mati_hauptmusik_button_x")) {
								musikXIcon.style['visibility'] = 'hidden';
							}
						}
						else {
							matiUtil.musikAusschalten(document.getElementById("mati_hauptmusik"));
							for (let musikXIcon of document.getElementsByClassName("mati_hauptmusik_button_x")) {
								musikXIcon.style['visibility'] = 'visible';
							}
						}
						mati.broadcast('setSound');
						break;
                    case 'spielAbbrechen':
                        //FIXME wenn man im Endresultat ist und Spiel abbricht, geht er nicht ins Hauptmenue
                        if (mati.spielLaeuft && mati.queueEnthaeltLaufendesSpiel) {
                            matiUtil.befehlsqueueLeeren();
                            mati.spielLaeuft = false;
                            mati.queueEnthaeltLaufendesSpiel = false;
                            matiUtil.pushBefehl(function() {
                                mati.broadcast('zeigeHauptmenue');
                                mati.zeigeContainer(document.getElementById('mati_spiel_lobby'), matiUtil.gotoNaechsterBefehl);
                            });
                        }
                        break;
				}
			};				
		
			var onAenderungDerFenstergroesse = function() {
				var allesFontSize = Math.min(window.innerWidth, window.innerHeight) / 23;
				document.getElementById('mati_spiel_alles').style["font-size"] = allesFontSize + "px";
				
				mati.setFrageGroesseUndPosition();
				
				let oldMatiFrageDisplay = document.getElementById('mati_frage').style['display'];
				document.getElementById('mati_frage').style['display'] = 'block';
				mati.schrittweiseResizeBisEsPasst(document.getElementById('mati_frage_spieler_container'), document.getElementById('mati_frage_spieler'));
				document.getElementById('mati_frage').style['display'] = oldMatiFrageDisplay;
				
				//Workaround fuer verbuggter Microsoft-Edge-Browser, der mit vh in Animationen nicht klar kommt.
				let hoehe = document.getElementById('mati_spiel_alles').offsetHeight;
				document.getElementById('mati_keyframes_3d').innerHTML = `
					@keyframes mati_animation_box_show {
						from {
							transform: perspective(${hoehe*4}px) translateZ(${-hoehe/2}px) rotateX(-90deg) translateZ(${hoehe/2}px);
						}
						to {
							transform: perspective(${hoehe*4}px) translateZ(${-hoehe/2}px) rotateX(0deg) translateZ(${hoehe/2}px);
						}
					}
					@keyframes mati_animation_box_hide {
						from {
							transform: perspective(${hoehe*4}px) translateZ(${-hoehe/2}px) rotateX(0deg) translateZ(${hoehe/2}px);
						}
						to {
							transform: perspective(${hoehe*4}px) translateZ(${-hoehe/2}px) rotateX(90deg) translateZ(${hoehe/2}px);
						}
					}
				`;
			};
			onAenderungDerFenstergroesse();
			window.addEventListener( 'resize', onAenderungDerFenstergroesse, false );
			
			
			
		</script>

	</body>
</html>