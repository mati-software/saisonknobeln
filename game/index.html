<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Saisonknobeln</title>
		
		<style id="mati_keyframes_3d">
			@keyframes mati_animation_box_show {
				from {
					transform: perspective(400vh) translateZ(-50vh) rotateX(-90deg) translateZ(50vh);
				}
				to {
					transform: perspective(400vh) translateZ(-50vh) rotateX(0deg) translateZ(50vh);
				}
			}
			@keyframes mati_animation_box_hide {
				from {
					transform: perspective(400vh) translateZ(-50vh) rotateX(0deg) translateZ(50vh);
				}
				to {
					transform: perspective(400vh) translateZ(-50vh) rotateX(90deg) translateZ(50vh);
				}
			}
		</style>
		
		
		<style>
			body {
				overflow:hidden;
				padding:0;
				border:0;
				margin:0;
			}
			
			#mati_spiel_alles {
				position:fixed;
				top:0;
				left:0;
				right:0;
				bottom:0;
				background-color:black;
				font-family: Helvetica, Arial, sans-serif;
				
				-webkit-user-select: none;  
				-moz-user-select: none;    
				-ms-user-select: none;      
				user-select: none;
			}
			
			#mati_spiel_spielerliste_container {
				position:absolute;
				bottom:0;
				left:0;
				top:6em;
				width:50%;
				overflow:hidden;
			}
			#mati_spiel_spielerwarteliste_container {
				position:absolute;
				bottom:0;
				right:0;
				top:6em;
				width:50%;
				overflow:hidden;
			}
			#mati_spiel_spielerliste {
				position:absolute;
				top:0;
				bottom:1em;
				right:.5em;
				width:12em;
				background-color:#666;
				border-radius:1em;
			}
			#mati_spiel_spielerwarteliste {
				position:absolute;
				top:0;
				left:.5em;
				bottom:1em;
				width:12em;
				background-color:#666;
				border-radius:1em;
			}
			#mati_spiel_spielerliste_content,
			#mati_spiel_spielerwarteliste_content {
				position:absolute;
				top:2em;
				left:.2em;
				right:.2em;
				bottom:.2em;
				overflow:hidden;
				background-color:silver;
				border-bottom-left-radius:.8em;
				border-bottom-right-radius:.8em;
				padding-left:.6em;
			}
			#mati_spiel_spielerliste_caption,
			#mati_spiel_spielerwarteliste_caption {
				position:absolute;
				top:0;
				left:0;
				right:0;
				height:2em;
				line-height:2em;
				vertical-align:middle;
				padding-left:1em;
				color:white;
			}
			h1 {
				font-size:2em;
				line-height:1.5em;
				vertical-align:middle;
				height:1.5em;
				font-weight:bold;
				text-align:center;
				margin:0;
				padding:0;
			}
			#mati_spiel_joincode_container {
				height:2em;
				line-height:2em;
				vertical-align:middle;
				text-align:center;
			}
			
			#mati_spiel_spielerliste_content ul,
			#mati_spiel_spielerwarteliste_content ul {
				margin:0;
				padding:.3em 0 .3em 0;
				list-style-type: none;
			}
			.mati_spieler {
				padding:0;
				margin:0;
				height:2.2em;
				vertical-align:middle;
				overflow:hidden;
				position:relative;
				width:10em;
			}
			span.mati_spieler_img {
				position:absolute;
				left:.2em;
				top:.2em;
				border-radius:.9em;
				padding:.1em;
				width:1.6em;
				height:1.6em;
				overflow:hidden;
				z-index:2;
				box-shadow:0 0 .2em black;
			}
			span.mati_spieler_img img {
				float:left;
				width:1.6em;
				height:1.6em;
				border-radius:.8em;
			}
			span.mati_spieler_text {
				position:absolute;
				display:block;
				line-height:1.4em;
				top:.4em;
				bottom:.4em;
				left:1em;
				right:.2em;
				padding-left:1.2em;
				padding-right:.1em;
				background-color:black;
				z-index:1;
				box-shadow:0 0 .2em black;
				overflow:hidden;
				white-space: nowrap;
				text-overflow: ellipsis;
			}
			
			.mati_box {
				position:absolute;
				left:0;
				top:0;
				width:100%;
				height:100%;
				overflow:hidden;
				backface-visibility: hidden;
				visibility: hidden;
				background-repeat: no-repeat;
				background-size: cover;
                background-position: center;				 
			}
			
			.mati_box_hide {
				animation-name: mati_animation_box_hide;
				animation-duration: 1s;
				animation-iteration-count: 1;
				transform: perspective(400vh) translateZ(-50vh) rotateX(90deg) translateZ(50vh);
			}
			.mati_box_hide_back {
				animation-name: mati_animation_box_show;
				animation-direction: reverse;
				animation-duration: 1s;
				animation-iteration-count: 1;
				transform: perspective(400vh) translateZ(-50vh) rotateX(-90deg) translateZ(50vh);
			}
			.mati_box_show {
				animation-name: mati_animation_box_show;
				animation-duration: 1s;
				animation-iteration-count: 1;
			}
			.mati_box_show_back {
				animation-name: mati_animation_box_hide;
				animation-direction: reverse;
				animation-duration: 1s;
				animation-iteration-count: 1;
			}
			
			#mati_spiel_lobby {
				background-color: #ddd;
				color: black;
			}
			
			#mati_rubrik_intro {
				background-color: #CCC;
			}
			#mati_rubrik_intro svg {
				position: absolute;
				left: 0;
				top: 0;
				width: 100%;
				top: 50%;
				height: 12vw;
				margin-top: -6vw;
			}
			#mati_rubrik_intro_balken1 {
				position: absolute;
				top: 50%;
				height: 12vw;
				margin-top: -6vw;
				background-color: rgba(255, 255, 255, .9);
				left: 0;
			}
			#mati_rubrik_intro_balken1::before,
			#mati_rubrik_intro_balken2::before {
				content: ' ';
				position: absolute;
				top: -2vw;
				left: 0;
				right: 0;
				height: 1vw;
				background-color: rgba(255, 255, 255, .9);
			}
			#mati_rubrik_intro_balken1::after,
			#mati_rubrik_intro_balken2::after {
				content: ' ';
				position: absolute;
				bottom: -2vw;
				left: 0;
				right: 0;
				height: 1vw;
				background-color: rgba(255, 255, 255, .9);
			}
			#mati_rubrik_intro_balken2 {
				position: absolute;
				top: 50%;
				height: 12vw;
				margin-top: -6vw;
				background-color: rgba(255, 255, 255, .9);
				right: 0;
			}
			
			#mati_frage {
				background-color: #AAA;
			}
			#mati_frage_erlaeuterung {
				border-bottom-left-radius: 1em;
				border-bottom-right-radius: 1em;
				vertical-align:middle;
				background-color: rgba(255, 255, 255, .9);
				padding: .5em 1em;
				text-align:center;
			}
			#mati_frage_text_und_bild {
				border-radius: 1em;
				padding:.5em;
				background-color: rgba(255, 255, 255, .9);
				position:relative;
				display: grid;
				grid-template-columns: minmax(50%,1fr) minmax(0,15em);
			}
			#mati_frage_bild {
			}
			#mati_frage_text_container {
				position:relative;
			}
			#mati_frage_text {
				font-size: 200%;
				height: auto;
				width: auto;
				position:absolute;
				text-align: center;
			}
			#mati_frage_spieler {
			}
			#mati_frage_grid {
				display: grid;
				grid-template-rows: auto 11em 1fr;
				grid-row-gap: 1em;
				position: absolute;
				top: 0;
				bottom: 1em;
				left: 1em;
				right: 1em;
				justify-items: stretch;
			}
			
			#mati_frage_ergebnis {
				background-color: #BBB;
			}
			
		</style>
	</head>
	<body>
		<div id="mati_spiel_alles">
			<div id="mati_spiel_lobby" class="mati_box">
			</div>
			<div id="mati_rubrik_intro" class="mati_box">
				<div id="mati_rubrik_intro_balken1"></div>
				<div id="mati_rubrik_intro_balken2"></div>
				<svg viewbox="0 0 1000 150">
					<defs>
						<filter id="mati_rubrik_text_shadow" filterUnits="userSpaceOnUse" x="0" y="0" width="100%" height="100%">
							<feGaussianBlur result="blurOut" in="SourceAlpha" stdDeviation="5" />
							<feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
						</filter>				
						<linearGradient id="mati_rubrik_text_verlauf" x1="0" y1="0" x2="0" y2="1">
							<stop offset="0" stop-color="#eeeeee" />
							<stop offset="1" stop-color="#bbbbbb" />
						</linearGradient>
					</defs>
					<text font-size="100" filter="url(#mati_rubrik_text_shadow)" stroke="url(#mati_rubrik_text_verlauf)" fill="none" stroke-width="3" font-weight="800" text-anchor="middle" id="mati_rubrik_intro_name" x="50%" y="110">
						Hallo Welt
					</text>
				</svg>
			</div>
			<div id="mati_frage" class="mati_box">
				<div id="mati_frage_grid">
					<div id="mati_frage_erlaeuterung"></div>
					<div id="mati_frage_text_und_bild">
						<div id="mati_frage_text_container">
							<div id="mati_frage_text"></div>
						</div>
						<div id="mati_frage_bild"></div>
					</div>
					<div id="mati_frage_spieler"></div>
				</div>
			</div>
			<div id="mati_frage_ergebnis" class="mati_box">
				TODO: Ergebnis der Frage
			</div>
		</div>


		<script src="matiUtil.js" rel="script" type="application/javascript"></script>
		<script src="matiFarbutil.js" rel="script" type="application/javascript"></script>
		<script src="https://tiltspot.tv/api/game/game-1.0.0.js" rel="script" type="application/javascript"></script>
		<script src="saisonknobeln.js" rel="script" type="application/javascript"></script>
		<script>
			Tiltspot.on.ready = function() {
				console.log('ready');
				mati.setSpracheCode('en');
				matiUtil.pushBefehl(function() {
					mati.broadcast('zeigeHauptmenue');
					mati.zeigeContainer(document.getElementById('mati_spiel_lobby'), false, matiUtil.gotoNaechsterBefehl);
				});
			};
			Tiltspot.on.connect = function(controllerId) {
				console.log('Connect Controller ' + controllerId);
				mati.spielerChanged();
			}; 
			Tiltspot.on.disconnect = function(controllerId) {
				console.log('Controller ' + controllerId + ' disconnected');
				mati.spielerChanged();
			};
			Tiltspot.on.reconnect = function(controllerId) {
				console.log('Controller ' + controllerId + ' is back!');
				mati.spielerChanged();
				mati.sendMsg(controllerId);
			};
			Tiltspot.on.msg = function (controllerId, msg, data) {
				console.log('msg', controllerId, msg, data);
				switch (msg) { 
					case 'setSpracheCode':
						mati.setSpracheCode(data);
						break;
					case 'neuesSpiel':
						mati.neuesSpiel(data);
						break;
					case 'clientReady':
						//Client hat ggf. den letzten Befehl nicht mitbekommen
						mati.sendMsg(controllerId);
						break;
					case 'antwortAbgeben':
						//TODO bei Person speichern was seine angaben sind und gucken ob schon alle abgegeben haben
						let spieler = mati.spielerImLaufendenSpiel[controllerId];
						spieler.antwortAufAktuelleFrage = data.antwort;
						spieler.schaetzungAFuerAktuelleFrage = data.schaetzungAntwortA;
						spieler.schaetzungBFuerAktuelleFrage = data.schaetzungAntwortB;
						mati.gotoNaechsterBefehlFallsAlleAntwortenAbgegebenWurden();
						//Nochmal Wartebefehl senden, damit bei Smartphone-Browser-Reload keine erneute Stimmabgabe moeglich ist
						mati.sendMsg(controllerId, 'zeigeWarten');
						break;
				}
			};				
		
			var onAenderungDerFenstergroesse = function() {
				var allesFontSize = Math.min(window.innerWidth, window.innerHeight) / 23;
				document.getElementById('mati_spiel_alles').style["font-size"] = allesFontSize + "px";
				
				mati.setFrageGroesseUndPosition();
				
				//Workaround fuer verbuggter Microsoft-Edge-Browser, der mit vh in Animationen nicht klar kommt.
				let hoehe = document.getElementById('mati_spiel_alles').offsetHeight;
				document.getElementById('mati_keyframes_3d').innerHTML = `
					@keyframes mati_animation_box_show {
						from {
							transform: perspective(${hoehe*4}px) translateZ(${-hoehe/2}px) rotateX(-90deg) translateZ(${hoehe/2}px);
						}
						to {
							transform: perspective(${hoehe*4}px) translateZ(${-hoehe/2}px) rotateX(0deg) translateZ(${hoehe/2}px);
						}
					}
					@keyframes mati_animation_box_hide {
						from {
							transform: perspective(${hoehe*4}px) translateZ(${-hoehe/2}px) rotateX(0deg) translateZ(${hoehe/2}px);
						}
						to {
							transform: perspective(${hoehe*4}px) translateZ(${-hoehe/2}px) rotateX(90deg) translateZ(${hoehe/2}px);
						}
					}
				`;
			};
			onAenderungDerFenstergroesse();
			window.addEventListener( 'resize', onAenderungDerFenstergroesse, false );
		</script>

	</body>
</html>