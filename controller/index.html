<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Saisonknobeln</title>
		<style>
			body {
				overflow:hidden;
				padding:0;
				border:0;
				margin:0;
				background-color:black;
			}
		
			#mati_controller_alles {
				position:fixed;
				top:0;
				left:0;
				right:0;
				bottom:0;
				color:white;
				font-family: Helvetica, Arial, sans-serif;
				
				-webkit-user-select: none;  
				-moz-user-select: none;    
				-ms-user-select: none;      
				user-select: none;
			}
			
			#mati_content_container {
				position:absolute;
				left:0;
				right:0;
				bottom:0;
				top:4.4em;
				box-shadow:0 0 .4em black;
			}
			
			.mati_buttonbox {
				position:absolute;
				left:0;
				right:0;
				bottom:0;
				top:0;
				border-width:.5em;
				border-style:solid;
				box-shadow: inset 0 0 1em black;
			}
			
			.mati_button,
			.mati_button_deaktiviert,
			.mati_button_focus {
				color: black;
				padding:.5em;
				text-align:center;
				line-height:2em;
				border-radius:1.5em;
				vertical-align:middle;
				margin:1em;
				box-shadow:0 0 1em black;
			}
			.mati_button_deaktiviert {
				opacity: .3;
			}
			
			.mati_spieler {
				padding:0;
				margin:0;
				height:2.2em;
				vertical-align:middle;
				overflow:hidden;
				position:relative;
				width:10em;
			}
			span.mati_spieler_img {
				position:absolute;
				left:.2em;
				top:.2em;
				border-radius:.9em;
				padding:.1em;
				width:1.6em;
				height:1.6em;
				overflow:hidden;
				z-index:2;
				box-shadow:0 0 .2em black;
			}
			span.mati_spieler_img img {
				float:left;
				width:1.6em;
				height:1.6em;
				border-radius:.8em;
			}
			span.mati_spieler_text {
				position:absolute;
				display:block;
				line-height:1.4em;
				top:.4em;
				bottom:.4em;
				left:1em;
				right:.2em;
				padding-left:1.2em;
				padding-right:.1em;
				background-color:black;
				z-index:1;
				box-shadow:0 0 .2em black;
				overflow:hidden;
				white-space: nowrap;
				text-overflow: ellipsis;
			}
			#mati_spieler_container {
				font-size:200%;
			}
			
			#mati_flaggen_container {
				position:absolute;
				bottom:1em;
				left:1em;
				right:1em;
				text-align:center;
			}
			
			img.mati_flagge {
				height:3em;
				width:auto;
				border:.5em solid transparent; 
			}
			@keyframes mati_animation_flagge_aktiv {
				from {
					border-color: rgba(255, 255, 255, 0);
				}
				to {
					border-color: rgba(255, 255, 255, 1)
				}
			}
			img.mati_flagge_aktiv {
				border-color: white;
				animation-name: mati_animation_flagge_aktiv;
				animation-duration: 2s;
				animation-iteration-count: infinite;
				animation-direction: alternate;
			}
			
		</style>
		<style id="mati_farbstyle">
		</style>
	</head>
	<body>
		<div id="mati_controller_alles">
			<div id="mati_spieler_container">
			</div>
			<div id="mati_content_container">
				<div id="mati_hauptmenue" class="mati_buttonbox">
					<div id="mati_hauptmenue_buttons">
					</div>
					<div id="mati_flaggen_container">
					</div>
				</div>
			</div>
		</div>
		
		<script src="matiUtil.js" rel="script" type="application/javascript"></script>
		<script src="matiFarbutil.js" rel="script" type="application/javascript"></script>
		<script src='https://tiltspot.tv/api/controller/controller-1.0.0.js' rel='script' type='application/javascript'></script>
		<script>
			var mati = {
				farbe : matiFarbutil.WEISS,
				spracheCode : 'en',
				sprachen : []
			};
			
			mati.renderFarbe = function() {
				let hell50dunkel80 = matiFarbutil.toCssString(matiFarbutil.gedimmteFarbe(matiFarbutil.aufgehellteFarbe(mati.farbe, .5), .8));
				let hell50 = matiFarbutil.toCssString(matiFarbutil.aufgehellteFarbe(mati.farbe, .5));
				let dunkel50 = matiFarbutil.toCssString(matiFarbutil.gedimmteFarbe(mati.farbe, .5));
				let dunkel30 = matiFarbutil.toCssString(matiFarbutil.gedimmteFarbe(mati.farbe, .3));
				document.getElementById('mati_farbstyle').innerHTML = `
					body {
						background-color:${dunkel30};
					}
				
					.mati_buttonbox {
						background: ${dunkel50} radial-gradient(circle, ${dunkel50}, ${dunkel30});
						border-color: ${hell50};
					}
					
					.mati_button,
					.mati_button_deaktiviert {
						background: ${hell50} radial-gradient(circle, ${hell50}, ${hell50dunkel80});
					}
					.mati_button_focus {
						background: ${hell50dunkel80} radial-gradient(circle, ${hell50dunkel80}, ${hell50});
					}
					.mati_spieler_img {
						background-color:${hell50};
					}
					.mati_spieler_text {
						color: ${hell50};
						background: ${dunkel50} linear-gradient(135deg, ${dunkel50}, ${dunkel30});
					}
				`;
			};
			mati.renderFarbe();
			
			Tiltspot.on.ready = function(){
				console.log('ready');
				document.getElementById('mati_spieler_container').innerHTML = `
					<div class="mati_spieler">
						<span class="mati_spieler_img">
							<img src="${Tiltspot.get.user().profilePicture}" />
						</span>
						<span class="mati_spieler_text">${matiUtil.htmlEscape(Tiltspot.get.user().nickname)}</span>
					</div>
				`;
				
				matiUtil.pushBefehl(function() {
					matiUtil.loadJson(Tiltspot.get.assetUrl("language-list.json"), function(sprachen) {
						console.log(sprachen);
						mati.sprachen = sprachen;
						
						document.getElementById('mati_flaggen_container').innerHTML = mati.sprachen.map(function (sprache) {
							return `
								<img id="mati_flagge_code_${sprache.code}" class="${sprache.code === mati.spracheCode ? 'mati_flagge mati_flagge_aktiv' : 'mati_flagge'}" src="${Tiltspot.get.assetUrl(`gui-l10n/${sprache.code}.svg`)}" alt="${Tiltspot.get.assetUrl(`gui-l10n/${sprache.name}.svg`)}" />
							`;
						}).join('');
						
						for (let sprache of mati.sprachen) {
							let spracheCode = sprache.code;
							document.getElementById(`mati_flagge_code_${sprache.code}`).addEventListener('click', function() {
								Tiltspot.send.msg('setSpracheCode', spracheCode);
							});
						}
						
						matiUtil.gotoNaechsterBefehl();
					});
				});
			};
			
			Tiltspot.on.msg = function (msg, data) {
				console.log('msg', msg, data);
				switch (msg) { 
					case 'setFarbe':
						matiUtil.pushBefehl(function() {
							mati.farbe = data;
							mati.renderFarbe();
							matiUtil.gotoNaechsterBefehl();
						});
						break;
					case 'setSpracheCode':
						matiUtil.pushBefehl(function() {
							mati.spracheCode = data;
							matiUtil.loadJson(Tiltspot.get.assetUrl(`gui-l10n/${mati.spracheCode}.json`), function(guiTexte) {
								matiUtil.l10nTexte = guiTexte;
								document.getElementById('mati_hauptmenue_buttons').innerHTML = `
									<div class="mati_button">${matiUtil.l10nHtml('Neues Spiel')}</div>
									<div class="mati_button">${matiUtil.l10nHtml('Spiel fortsetzen')}</div>
									<div class="mati_button">${matiUtil.l10nHtml('Beenden')}</div>
								`;
								
								for (let flaggeElement of document.getElementsByClassName('mati_flagge_aktiv')) {
									flaggeElement.classList.remove('mati_flagge_aktiv');
								}
								
								document.getElementById(`mati_flagge_code_${mati.spracheCode}`).classList.add('mati_flagge_aktiv');
								
								matiUtil.gotoNaechsterBefehl();
							});
						});
						break;
				}
			};
			
			
			
			var onAenderungDerFenstergroesse = function() {
				var allesFontSize = Math.min(window.innerWidth, window.innerHeight) / 20;
				document.getElementById('mati_controller_alles').style["font-size"] = allesFontSize + "px";
			};
			onAenderungDerFenstergroesse();
			window.addEventListener( 'resize', onAenderungDerFenstergroesse, false );
		</script>
	</body>
</html>