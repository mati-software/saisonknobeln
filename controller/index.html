<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
		<title>Saisonknobeln</title>
		<style id="mati_keyframes_3d">
			@keyframes mati_animation_box_show {
				from {
					transform: perspective(400vw) translateZ(-50vw) rotateY(90deg) translateZ(50vw);
				}
				to {
					transform: perspective(400vw) translateZ(-50vw) rotateY(0deg) translateZ(50vw);
				}
			}
			@keyframes mati_animation_box_hide {
				from {
					transform: perspective(400vw) translateZ(-50vw) rotateY(0deg) translateZ(50vw);
				}
				to {
					transform: perspective(400vw) translateZ(-50vw) rotateY(-90deg) translateZ(50vw);
				}
			}
		</style>
		<style>
			body {
				overflow:hidden;
				padding:0;
				border:0;
				margin:0;
				background-color:black;
			}
		
			#mati_controller_alles {
				position:fixed;
				top:0;
				left:0;
				right:0;
				bottom:0;
				color:white;
				font-family: Helvetica, Arial, sans-serif;
				
				-webkit-user-select: none;  
				-moz-user-select: none;    
				-ms-user-select: none;      
				user-select: none;
				
				touch-action: none;
				
				font-size: 5vmin;
			}
			
			#mati_content_container {
				position:absolute;
				left:0;
				right:0;
				bottom:0;
				top:4.4em;
				box-shadow:0 0 .4em black;
				z-index:2;
			}
			
			.mati_box {
				position:absolute;
				left:0;
				right:0;
				bottom:0;
				top:0;
				border-width:.5em;
				border-style:solid;
				box-shadow: inset 0 0 1em black;
				
				visibility: hidden;
				
				backface-visibility: hidden;
			}
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			.mati_button {
				color: black;
				padding:.5em;
				text-align:center;
				line-height:2em;
				border-radius:1.5em;
				vertical-align:middle;
			}
			.mati_box .mati_button {
				box-shadow:0 0 1em black;
				margin:1em;
			}
			
			@keyframes mati_animation_buttoneffekt {
				from {
					transform: scale(1);
					opacity:1;
				}
				to {
					transform: scale(4);
					opacity:0;
				}
			}
			.mati_buttoneffekt_container {
				position:absolute;
				left:1.5em;
				right:1.5em;
				animation-name: mati_animation_buttoneffekt;
				animation-duration: 1s;
				animation-timing-function: linear;
				z-index:3;
			}
			
			.mati_box_hide {
				animation-name: mati_animation_box_hide;
				animation-duration: 1s;
				animation-iteration-count: 1;
				transform: perspective(400vw) translateZ(-50vw) rotateY(-90deg) translateZ(50vw);
			}
			.mati_box_hide_back {
				animation-name: mati_animation_box_show;
				animation-direction: reverse;
				animation-duration: 1s;
				animation-iteration-count: 1;
				transform: perspective(400vw) translateZ(-50vw) rotateY(90deg) translateZ(50vw);
			}
			.mati_box_show {
				animation-name: mati_animation_box_show;
				animation-duration: 1s;
				animation-iteration-count: 1;
			}
			.mati_box_show_back {
				animation-name: mati_animation_box_hide;
				animation-direction: reverse;
				animation-duration: 1s;
				animation-iteration-count: 1;
			}
			
			.mati_spieler {
				padding:0;
				margin:0;
				height:2.2em;
				vertical-align:middle;
				overflow:hidden;
				position:relative;
				width:10em;
				z-index:1;
			}
			span.mati_spieler_img {
				position:absolute;
				left:.2em;
				top:.2em;
				border-radius:.9em;
				padding:.1em;
				width:1.6em;
				height:1.6em;
				overflow:hidden;
				z-index:2;
				box-shadow:0 0 .2em black;
			}
			span.mati_spieler_img img {
				float:left;
				width:1.6em;
				height:1.6em;
				border-radius:.8em;
			}
			span.mati_spieler_text {
				position:absolute;
				display:block;
				line-height:1.4em;
				top:.4em;
				bottom:.4em;
				left:1em;
				right:.2em;
				padding-left:1.2em;
				padding-right:.1em;
				background-color:black;
				z-index:1;
				box-shadow:0 0 .2em black;
				overflow:hidden;
				white-space: nowrap;
				text-overflow: ellipsis;
			}
			#mati_spieler_container {
				font-size:200%;
			}
			
			#mati_flaggen_container {
				position:absolute;
				bottom:1em;
				left:1em;
				right:1em;
				text-align:center;
			}
			
			img.mati_flagge {
				height:3em;
				width:auto;
				border:.5em solid transparent; 
			}
			@keyframes mati_animation_flagge_aktiv {
				from {
					border-color: rgba(255, 255, 255, 0);
				}
				to {
					border-color: rgba(255, 255, 255, 1)
				}
			}
			img.mati_flagge_aktiv {
				border-color: white;
				animation-name: mati_animation_flagge_aktiv;
				animation-duration: 2s;
				animation-iteration-count: infinite;
				animation-direction: alternate;
			}
			
			#mati_warten_text {
				padding:1em;
				text-align:center;
			}
			
			#mati_schaetzung_text {
				padding:1em 1em 1em 1em;
				text-align:center;
			}
			
			#mati_schieberegler_text_a,
			#mati_schieberegler_text_b {
				padding:0 4em 0 4em;
				text-align:center;
			}
			
			.mati_schieberegler {
				height: 3.5em;
				position: relative;
			}
			.mati_kleiner_button {
				width: 1.5em;
				height: 1.5em;
				line-height: 1.5em;
				text-align: center;
				vertical-align: middle;
				border-radius:.75em;
				color:black;
				font-size:200%;
				box-shadow:0 0 1em black;
			}
			.mati_schieberegler_minus {
				position: absolute;
				left:.5em;
				top:0;
			}
			.mati_schieberegler_plus {
				position: absolute;
				right:.5em;
				top:0;
			}
			.mati_schieberegler_anzeige {
				position:absolute;
				top:.5em;
				left:4.5em;
				right:4.5em;
				height:2em;
				background-color:black;
				box-shadow:0 0 1em black;
			}
			.mati_schieberegler_anzeige_balken {
				position:absolute;
				top:0;
				bottom:0;
				left:0;
				width:50%;
				background-color:silver;
			}
			.mati_schieberegler_anzeige_balken_transition {
				transition: width .5s;
			}
			.mati_schieberegler_anzeige_zahl {
				position:absolute;
				top:0;
				bottom:0;
				left:0;
				right:0;
				line-height:2em;
				text-align: center;
				vertical-align: middle;
				text-shadow: 0 0 .25em black;
				font-weight:bold;
			}
			
			.mati_schaetzung_flexbox {
				display: flex;
				flex-flow: row wrap;
			}
			.mati_schaetzung_flexitem {
				flex-grow: 1;
				flex-shrink: 1;
				flex-basis: 100%;
			}
			#mati_schieberegler_container1 {
				padding-top: 1em;
			}
			#mati_schieberegler_container2 {
				padding-top: 1em;
				padding-bottom: 1em;
			}
			
			@media (min-aspect-ratio:11/16) {
				#mati_schieberegler_container1,
				#mati_schieberegler_container2 {
					padding: 0;
				}
			}
			@media (min-aspect-ratio:3/4) {
				#mati_schieberegler_container2 {
					display: none;
				}
				#mati_controller_alles {
					font-size: 4.8vmin;
				}
			}
			@media (min-aspect-ratio:4/3) {
				#mati_controller_alles {
					font-size: 5vmin;
				}
			}
			@media (min-aspect-ratio:16/9) {
				#mati_schieberegler_container1 {
					flex-basis: 50%;
				}
				#mati_schieberegler_container2 {
					flex-basis: 50%;
					display: block;
				}
			}
		</style>
		<style id="mati_farbstyle">
		</style>
	</head>
	<body>
		<div id="mati_controller_alles">
			<div id="mati_spieler_container">
			</div>
			<div id="mati_content_container">
				<div id="mati_hauptmenue" class="mati_box">
					<div class="mati_button" id="mati_button_neues_spiel"></div>
					<div class="mati_button" id="mati_button_beenden"></div>
					<div id="mati_flaggen_container">
					</div>
				</div>
				<div id="mati_spiel_abschliessen" class="mati_box">
					<div class="mati_button" id="mati_button_spiel_abschliessen"></div>
				</div>
				<div id="mati_pausemenue" class="mati_box">
					<div class="mati_button" id="mati_button_spiel_fortsetzen"></div>
					<div class="mati_button" id="mati_button_spiel_abbrechen"></div>
				</div>
				<div id="mati_wartebild" class="mati_box">
					<div id="mati_warten_text">
					</div>
				</div>
				<div id="mati_antwortmoeglichkeiten" class="mati_box">
					<div class="mati_button" id="mati_antwortmoeglichkeit_a"></div>
					<div class="mati_button" id="mati_antwortmoeglichkeit_b"></div>
				</div>
				<div id="mati_schaetzung" class="mati_box">
					<div class="mati_schaetzung_flexbox">
						<div class="mati_schaetzung_flexitem" id="mati_schaetzung_text"></div>
						<div class="mati_schaetzung_flexitem" id="mati_schieberegler_container1">
							<div id="mati_schieberegler_text_a"></div>
							<div class="mati_schieberegler">
								<div class="mati_schieberegler_anzeige">
									<div class="mati_schieberegler_anzeige_balken" id="mati_schieberegler_anzeige_balken_a"></div>
									<div class="mati_schieberegler_anzeige_zahl" id="mati_schieberegler_anzeige_zahl_a"></div>
								</div>
								<div id="mati_schieberegler_minus_a" class="mati_kleiner_button mati_schieberegler_minus">&minus;</div>
								<div id="mati_schieberegler_plus_a" class="mati_kleiner_button mati_schieberegler_plus">&plus;</div>
							</div>
						</div>
						<div class="mati_schaetzung_flexitem" id="mati_schieberegler_container2">
							<div id="mati_schieberegler_text_b"></div>
							<div class="mati_schieberegler">
								<div class="mati_schieberegler_anzeige">
									<div class="mati_schieberegler_anzeige_balken" id="mati_schieberegler_anzeige_balken_b"></div>
									<div class="mati_schieberegler_anzeige_zahl" id="mati_schieberegler_anzeige_zahl_b"></div>
								</div>
								<div id="mati_schieberegler_minus_b" class="mati_kleiner_button mati_schieberegler_minus">&minus;</div>
								<div id="mati_schieberegler_plus_b" class="mati_kleiner_button mati_schieberegler_plus">&plus;</div>
							</div>
						</div>
						<div class="mati_schaetzung_flexitem">
							<div class="mati_button" id="mati_button_schaetzung_submit"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script src="matiUtil.js" rel="script" type="application/javascript"></script>
		<script src="matiFarbutil.js" rel="script" type="application/javascript"></script>
		<script src='https://tiltspot.tv/api/controller/controller-1.0.0.js' rel='script' type='application/javascript'></script>
		<script>
			//TODO ich koennte versuchen einzelne boxen komplett auszublenden damit es nicht mehr so ruckelt
			//TODO schieberegler auch bei touch/wischen auf Regler veraendern
			
			
			var mati = {
				farbe : matiFarbutil.WEISS,
				spracheCode : null,
				sprachen : [],
				aktuellSichbarerContainer : null,
				aktuellerContainerLautSpielstatus : null,
				buttonMitFokus : null,
				pointerIdFuerButtonMitFokus : null,
				anzahlSpieler : 0,
				schaetzungAntwortA : 0,
				schaetzungAntwortB : 0,
				gewaehlteAnwortmoeglichkeit : 0
			};
			
			mati.renderFarbe = function() {
				let hell50dunkel80 = matiFarbutil.toCssString(matiFarbutil.gedimmteFarbe(matiFarbutil.aufgehellteFarbe(mati.farbe, .5), .8));
				let hell50 = matiFarbutil.toCssString(matiFarbutil.aufgehellteFarbe(mati.farbe, .5));
				let dunkel50 = matiFarbutil.toCssString(matiFarbutil.gedimmteFarbe(mati.farbe, .5));
				let dunkel30 = matiFarbutil.toCssString(matiFarbutil.gedimmteFarbe(mati.farbe, .3));
				document.getElementById('mati_farbstyle').innerHTML = `
					body {
						background-color:${dunkel30};
					}
				
					.mati_box {
						background: ${dunkel50} radial-gradient(circle, ${dunkel50}, ${dunkel30});
						border-color: ${hell50};
					}
					
					.mati_button {
						background: ${hell50} radial-gradient(circle, ${hell50}, ${hell50dunkel80});
					}
					.mati_button.mati_button_focus {
						background: ${hell50dunkel80} radial-gradient(circle, ${hell50dunkel80}, ${hell50});
					}
					.mati_spieler_img {
						background-color:${hell50};
					}
					.mati_spieler_text {
						color: ${hell50};
						background: ${dunkel50} linear-gradient(135deg, ${dunkel50}, ${dunkel30});
					}
					
					.mati_kleiner_button {
						background-color:${hell50};
						background:linear-gradient( 90deg, ${hell50dunkel80}, ${hell50}, ${hell50dunkel80});
					}
					.mati_kleiner_button.mati_button_focus {
						background-color:${hell50dunkel80};
						background:linear-gradient( 90deg, ${hell50}, ${hell50dunkel80}, ${hell50});
					}
					.mati_schieberegler_anzeige {
						background-color:${dunkel30};
					}
					.mati_schieberegler_anzeige_balken {
						background-color:${hell50};
						background:linear-gradient( 0deg, ${hell50dunkel80}, ${hell50} );
					}
				`;
			};
			
			mati.zeigeContainer = function(containerElement, rueckwaerts, callback) {
				if (containerElement === mati.aktuellSichbarerContainer) {
					callback();
					return;
				}
				
				containerElement.style['visibility'] = 'visible';
				containerElement.classList.remove('mati_box_hide');
				containerElement.classList.remove('mati_box_hide_back');
				containerElement.classList.add(rueckwaerts ? 'mati_box_show_back' : 'mati_box_show');
				
				if (mati.aktuellSichbarerContainer !== null) {
					mati.aktuellSichbarerContainer.classList.remove('mati_box_show');
					mati.aktuellSichbarerContainer.classList.remove('mati_box_show_back');
					mati.aktuellSichbarerContainer.classList.add(rueckwaerts ? 'mati_box_hide_back' : 'mati_box_hide');
				}
				
				setTimeout(function () {
					if (mati.aktuellSichbarerContainer !== null) {
						mati.aktuellSichbarerContainer.style['visibility'] = 'hidden';
					}
					
					mati.aktuellSichbarerContainer = containerElement;
					if (containerElement.id !== 'mati_pausemenue') {
						mati.aktuellerContainerLautSpielstatus = containerElement;
					}
					callback();
				}, 1000);
			};
			
			mati.updateSchaetzungGui = function() {
				document.getElementById('mati_schieberegler_anzeige_zahl_a').innerText = mati.schaetzungAntwortA;
				document.getElementById('mati_schieberegler_anzeige_zahl_b').innerText = mati.schaetzungAntwortB;
				document.getElementById('mati_schieberegler_anzeige_balken_a').style['width'] = Math.floor(mati.schaetzungAntwortA / mati.anzahlSpieler * 100) + '%';
				document.getElementById('mati_schieberegler_anzeige_balken_b').style['width'] = Math.floor(mati.schaetzungAntwortB / mati.anzahlSpieler * 100) + '%';
			};
			
			
			
			Tiltspot.on.ready = function() {
				Tiltspot.send.msg('clientReady');
			};
			
			Tiltspot.on.msg = function (msg, data) {
				if (document.getElementById('mati_spieler_container').getElementsByClassName('mati_spieler').length === 0) {
					document.getElementById('mati_spieler_container').innerHTML = `
						<div class="mati_spieler">
							<span class="mati_spieler_img">
								<img src="${Tiltspot.get.user().profilePicture}" />
							</span>
							<span class="mati_spieler_text">${matiUtil.htmlEscape(Tiltspot.get.user().nickname)}</span>
						</div>
					`;
				}
				
				if (mati.sprachen.length === 0) {
					matiUtil.pushBefehl(function() {
						if (mati.sprachen.length === 0) {
							matiUtil.loadJson(Tiltspot.get.assetUrl("language-list.json"), function(sprachen) {
								mati.sprachen = sprachen;
								
								document.getElementById('mati_flaggen_container').innerHTML = mati.sprachen.map(function (sprache) {
									return `
										<img id="mati_flagge_code_${sprache.code}" class="${sprache.code === mati.spracheCode ? 'mati_flagge mati_flagge_aktiv' : 'mati_flagge'}" src="${Tiltspot.get.assetUrl(`gui-l10n/${sprache.code}.svg`)}" alt="${Tiltspot.get.assetUrl(`gui-l10n/${sprache.name}.svg`)}" />
									`;
								}).join('');
								
								for (let sprache of mati.sprachen) {
									let spracheCode = sprache.code;
									document.getElementById(`mati_flagge_code_${sprache.code}`).addEventListener('click', function() {
										Tiltspot.send.msg('setSpracheCode', spracheCode);
									});
								}
								
								matiUtil.gotoNaechsterBefehl();
							});
						}
					});
				}
			
				if (data.farbe !== mati.farbe) {
					matiUtil.pushBefehl(function() {
						if (data.farbe !== mati.farbe) {
							mati.farbe = data.farbe;
							mati.renderFarbe();
							matiUtil.gotoNaechsterBefehl();
						}
					});
				}
				
				if (data.spracheCode !== mati.spracheCode) {
					matiUtil.pushBefehl(function() {
						if (data.spracheCode !== mati.spracheCode) {
							mati.spracheCode = data.spracheCode;
							matiUtil.loadJson(Tiltspot.get.assetUrl(`gui-l10n/${mati.spracheCode}.json`), function(guiTexte) {
								matiUtil.l10nTexte = guiTexte;
								
								document.getElementById('mati_warten_text').innerText = matiUtil.l10n('Bitte warten bis die nächste Interaktion möglich ist!');
								
								document.getElementById('mati_button_neues_spiel').innerText = matiUtil.l10n('Neues Spiel');
								document.getElementById('mati_button_beenden').innerText = matiUtil.l10n('Beenden');
								
								for (let flaggeElement of document.getElementsByClassName('mati_flagge_aktiv')) {
									flaggeElement.classList.remove('mati_flagge_aktiv');
								}
								document.getElementById(`mati_flagge_code_${mati.spracheCode}`).classList.add('mati_flagge_aktiv');

								document.getElementById('mati_button_spiel_fortsetzen').innerText = matiUtil.l10n('Spiel fortsetzen');
								document.getElementById('mati_button_spiel_abbrechen').innerText = matiUtil.l10n('Laufendes Spiel abbrechen');
								
								document.getElementById('mati_button_spiel_abschliessen').innerText = matiUtil.l10n('Spiel abschließen');
								
								document.getElementById('mati_schaetzung_text').innerText = matiUtil.l10n('Schätze wie viele Spieler (inklusive Du selbst) für die jeweilige Antwortmöglichkeit gestimmt haben!');
								document.getElementById('mati_button_schaetzung_submit').innerText = matiUtil.l10n('OK');
								
								matiUtil.gotoNaechsterBefehl();
							});
						}
					});
				}
			
				switch (msg) { 
					case 'zeigeHauptmenue':
						matiUtil.pushBefehl(function() {
							mati.zeigeContainer(document.getElementById('mati_hauptmenue'), false, matiUtil.gotoNaechsterBefehl);
						});
						break;
					case 'zeigeWarten':
						matiUtil.pushBefehl(function() {
							mati.zeigeContainer(document.getElementById('mati_wartebild'), false, matiUtil.gotoNaechsterBefehl);
						});
						break;
					case 'zeigeAntwortmoeglichkeiten':
						document.getElementById('mati_antwortmoeglichkeit_a').innerText = data.antwortMoeglichkeiten[0];
						document.getElementById('mati_antwortmoeglichkeit_b').innerText = data.antwortMoeglichkeiten[1];
						
						mati.anzahlSpieler = data.anzahlSpieler;
						
						document.getElementById('mati_schieberegler_text_a').innerText = data.antwortMoeglichkeiten[0];
						document.getElementById('mati_schieberegler_text_b').innerText = data.antwortMoeglichkeiten[1];
						
						matiUtil.pushBefehl(function() {
							mati.zeigeContainer(document.getElementById('mati_antwortmoeglichkeiten'), false, matiUtil.gotoNaechsterBefehl);
						});
						break;
					case 'zeigeSpielAbschliessen':
						matiUtil.pushBefehl(function() {
							mati.zeigeContainer(document.getElementById('mati_spiel_abschliessen'), false, matiUtil.gotoNaechsterBefehl);
						});
						break;
				}
			};
			
			
			
			
			
			
			
			
			
			
			
			document.addEventListener('pointerdown', function (event) {
				if (event.target.matches('.mati_button, .mati_kleiner_button') && event.target.id && mati.buttonMitFokus === null) {
					event.target.classList.add('mati_button_focus');
					mati.buttonMitFokus = event.target;
					mati.pointerIdFuerButtonMitFokus = event.pointerId;
					
					//Kleine Buttons schon bei pointerdown ausloesen
					if (event.target.matches('.mati_kleiner_button')) {
						switch (event.target.id) {
							case 'mati_schieberegler_minus_a':
							case 'mati_schieberegler_plus_b':
								if (mati.schaetzungAntwortA > 0) {
									mati.schaetzungAntwortA--;
									mati.schaetzungAntwortB = mati.anzahlSpieler - mati.schaetzungAntwortA;
									mati.updateSchaetzungGui();
								}
								break;
							case 'mati_schieberegler_minus_b':
							case 'mati_schieberegler_plus_a':
								if (mati.schaetzungAntwortB > 0) {
									mati.schaetzungAntwortB--;
									mati.schaetzungAntwortA = mati.anzahlSpieler - mati.schaetzungAntwortB;
									mati.updateSchaetzungGui();
								}
								break;
						}
					}
				}
			});
			document.addEventListener('pointerup', function (event) {
				if (event.pointerId !== mati.pointerIdFuerButtonMitFokus) {
					return;
				}
				
				if (event.target.matches('.mati_button')) {
					let boundingClientRect = event.target.getBoundingClientRect();

					//der Button ist eigentlich nicht rechteckig sondern hat runde Enden, aber besser gehts nicht
					//(JS hilft bei gedrueckter Maustaste in keinster Weise mit wenn es um das Verlassen der Hit-Area geht)
					let buttonWurdeGeklickt = event.target === mati.buttonMitFokus
								&& event.clientX >= boundingClientRect.left
								&& event.clientX <= boundingClientRect.right
								&& event.clientY >= boundingClientRect.top
								&& event.clientY <= boundingClientRect.bottom;
					
					if (buttonWurdeGeklickt) {
						//Button-Effekt
						let cloneButton = document.createElement("div");
						cloneButton.classList.add('mati_button');
						cloneButton.innerText = event.target.innerText;
						let cloneContainer = document.createElement("div");
						cloneContainer.classList.add('mati_buttoneffekt_container');
						cloneContainer.style['top'] = boundingClientRect.top + 'px';
						cloneContainer.appendChild(cloneButton);
						document.getElementById('mati_controller_alles').appendChild(cloneContainer);
						setTimeout(function () {
							document.getElementById('mati_controller_alles').removeChild(cloneContainer);
						}, 1000);
						
						//Aktion ausfuehren
						switch (event.target.id) {
							case 'mati_button_neues_spiel':
								Tiltspot.send.msg('neuesSpiel');
								break;
							case 'mati_antwortmoeglichkeit_a':
								mati.gewaehlteAnwortmoeglichkeit = 0;
								mati.schaetzungAntwortA = mati.gewaehlteAnwortmoeglichkeit === 0 ? Math.ceil(mati.anzahlSpieler / 2) : Math.floor(mati.anzahlSpieler / 2);
								mati.schaetzungAntwortB = mati.anzahlSpieler - mati.schaetzungAntwortA;
								mati.updateSchaetzungGui();
								matiUtil.pushBefehl(function() {
									mati.zeigeContainer(document.getElementById('mati_schaetzung'), false, function() {
										document.getElementById('mati_schieberegler_anzeige_balken_a').classList.add('mati_schieberegler_anzeige_balken_transition');
										document.getElementById('mati_schieberegler_anzeige_balken_b').classList.add('mati_schieberegler_anzeige_balken_transition');
										matiUtil.gotoNaechsterBefehl();
									});
								});
								break;
							case 'mati_antwortmoeglichkeit_b':
								mati.gewaehlteAnwortmoeglichkeit = 1;
								mati.schaetzungAntwortA = mati.gewaehlteAnwortmoeglichkeit === 0 ? Math.ceil(mati.anzahlSpieler / 2) : Math.floor(mati.anzahlSpieler / 2);
								mati.schaetzungAntwortB = mati.anzahlSpieler - mati.schaetzungAntwortA;
								mati.updateSchaetzungGui();
								matiUtil.pushBefehl(function() {
									mati.zeigeContainer(document.getElementById('mati_schaetzung'), false, function() {
										document.getElementById('mati_schieberegler_anzeige_balken_a').classList.add('mati_schieberegler_anzeige_balken_transition');
										document.getElementById('mati_schieberegler_anzeige_balken_b').classList.add('mati_schieberegler_anzeige_balken_transition');
										matiUtil.gotoNaechsterBefehl();
									});
								});
								break;
							case 'mati_button_schaetzung_submit':
								Tiltspot.send.msg('antwortAbgeben', {
									antwort: mati.gewaehlteAnwortmoeglichkeit,
									schaetzungAntwortA : mati.schaetzungAntwortA,
									schaetzungAntwortB : mati.schaetzungAntwortB
								});
								document.getElementById('mati_schieberegler_anzeige_balken_a').classList.remove('mati_schieberegler_anzeige_balken_transition');
								document.getElementById('mati_schieberegler_anzeige_balken_b').classList.remove('mati_schieberegler_anzeige_balken_transition');
								matiUtil.pushBefehl(function() {
									mati.zeigeContainer(document.getElementById('mati_wartebild'), false, matiUtil.gotoNaechsterBefehl);
								});
								break;
							case 'mati_button_spiel_abschliessen':
								Tiltspot.send.msg('spielAbschliessen');
								break;
						}
					}
				}
				
				mati.buttonMitFokus.classList.remove('mati_button_focus');
				mati.buttonMitFokus = null;
				mati.pointerIdFuerButtonMitFokus = null;
			});
			document.addEventListener('pointermove', function (event) {
				if (event.pointerId !== mati.pointerIdFuerButtonMitFokus) {
					return;
				}
				
				let boundingClientRect = event.target.getBoundingClientRect();

				//der Button ist eigentlich nicht rechteckig sondern hat runde Enden, aber besser gehts nicht
				//(JS hilft bei gedrueckter Maustaste in keinster Weise mit wenn es um das Verlassen der Hit-Area geht)
				let ueberButton = event.target === mati.buttonMitFokus
							&& event.clientX >= boundingClientRect.left
							&& event.clientX <= boundingClientRect.right
							&& event.clientY >= boundingClientRect.top
							&& event.clientY <= boundingClientRect.bottom;

				if (!ueberButton) {
					mati.buttonMitFokus.classList.remove('mati_button_focus');
					mati.buttonMitFokus = null;
					mati.pointerIdFuerButtonMitFokus = null;
				}
			});
			document.addEventListener('pointercancel', function (event) {
				if (event.pointerId !== mati.pointerIdFuerButtonMitFokus) {
					return;
				}
				mati.buttonMitFokus.classList.remove('mati_button_focus');
				mati.buttonMitFokus = null;
				mati.pointerIdFuerButtonMitFokus = null;
			});
			
			var onAenderungDerFenstergroesse = function() {
				//Workaround fuer verbuggter Microsoft-Edge-Browser, der mit vw in Animationen nicht klar kommt.
				let breite = document.getElementById('mati_controller_alles').offsetWidth;
				document.getElementById('mati_keyframes_3d').innerHTML = `
					@keyframes mati_animation_box_show {
						from {
							transform: perspective(${breite*4}px) translateZ(${-breite/2}px) rotateY(90deg) translateZ(${breite/2}px);
						}
						to {
							transform: perspective(${breite*4}px) translateZ(${-breite/2}px) rotateY(0deg) translateZ(${breite/2}px);
						}
					}
					@keyframes mati_animation_box_hide {
						from {
							transform: perspective(${breite*4}px) translateZ(${-breite/2}px) rotateY(0deg) translateZ(${breite/2}px);
						}
						to {
							transform: perspective(${breite*4}px) translateZ(${-breite/2}px) rotateY(-90deg) translateZ(${breite/2}px);
						}
					}
				`;
			};
			onAenderungDerFenstergroesse();
			window.addEventListener( 'resize', onAenderungDerFenstergroesse, false );
		</script>
	</body>
</html>